<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This tutorial will show you how to prepare your data for VIMuRe.">

<title>VIMuRe - üíª Tutorial 01: Preparing your data for VIMuRe in python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../figures/stable_diffusion_stickmen.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">üíª <strong>Tutorial 01</strong>: Preparing your data for VIMuRe in python</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">VIMuRe</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="" title="" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/latentnetworks/vimure">
          Source Code
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/latentnetworks/vimure/discussions">
          Ask Questions
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/latentnetworks/vimure/issues/new/choose">
          Report a Bug
          </a>
        </li>
    </ul>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">üè† Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../latest/install.html" class="sidebar-item-text sidebar-link">üì¶ Installation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../latest/tutorials.html" class="sidebar-item-text sidebar-link">üíª Tutorials</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../latest/people.html" class="sidebar-item-text sidebar-link">üìü Contact</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#step-1-download-edgelist" id="toc-step-1-download-edgelist" class="nav-link" data-scroll-target="#step-1-download-edgelist">Step 1: Download edgelist</a></li>
  <li><a href="#step-2-collect-individual-level-metadata" id="toc-step-2-collect-individual-level-metadata" class="nav-link" data-scroll-target="#step-2-collect-individual-level-metadata">Step 2: Collect individual-level metadata</a></li>
  <li><a href="#step-3-build-an-edge-list-per-village" id="toc-step-3-build-an-edge-list-per-village" class="nav-link" data-scroll-target="#step-3-build-an-edge-list-per-village">Step 3: Build an edge list per village</a>
  <ul class="collapse">
  <li><a href="#read-metadata" id="toc-read-metadata" class="nav-link" data-scroll-target="#read-metadata">3.1. Read metadata</a></li>
  <li><a href="#read-village-data" id="toc-read-village-data" class="nav-link" data-scroll-target="#read-village-data">3.2. Read village data</a></li>
  <li><a href="#read-reports-per-relationship-type" id="toc-read-reports-per-relationship-type" class="nav-link" data-scroll-target="#read-reports-per-relationship-type">3.3 Read reports per relationship type</a></li>
  <li><a href="#pre-process-the-data-to-build-the-edge-list" id="toc-pre-process-the-data-to-build-the-edge-list" class="nav-link" data-scroll-target="#pre-process-the-data-to-build-the-edge-list">3.4. Pre-process the data to build the edge list</a></li>
  </ul></li>
  <li><a href="#automating-the-process" id="toc-automating-the-process" class="nav-link" data-scroll-target="#automating-the-process">4. Automating the process</a>
  <ul class="collapse">
  <li><a href="#create-a-function-to-get-the-data-for-a-given-village-and-tie-type" id="toc-create-a-function-to-get-the-data-for-a-given-village-and-tie-type" class="nav-link" data-scroll-target="#create-a-function-to-get-the-data-for-a-given-village-and-tie-type">4.1. Create a function to get the data for a given village and tie type</a></li>
  <li><a href="#getting-an-edgelist-per-layer" id="toc-getting-an-edgelist-per-layer" class="nav-link" data-scroll-target="#getting-an-edgelist-per-layer">4.2 Getting an edgelist per layer</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">üíª <strong>Tutorial 01</strong>: Preparing your data for VIMuRe in python</h1>
<p class="subtitle lead">VIMuRe v0.1.0 (latest)</p>
  <div class="quarto-categories">
    <div class="quarto-category">basics</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    This tutorial will show you how to prepare your data for VIMuRe.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you use <code>VIMuRe</code> in your research, please cite <span class="citation" data-cites="de_bacco_latent_2023">(<a href="#ref-de_bacco_latent_2023" role="doc-biblioref">De Bacco et al. 2023</a>)</span>.</p>
</div>
</div>
<p>TLDR: By the end of this tutorial, you should produce a data frame in the following format:</p>
<div style="width:60%;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;">ego</th>
<th style="text-align: right;">alter</th>
<th style="text-align: right;">reporter</th>
<th style="text-align: left;">tie_type</th>
<th style="text-align: left;">layer</th>
<th style="text-align: right;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">103101</td>
<td style="text-align: right;">103201</td>
<td style="text-align: right;">103201</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">101201</td>
<td style="text-align: right;">102901</td>
<td style="text-align: right;">102901</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">111904</td>
<td style="text-align: right;">112602</td>
<td style="text-align: right;">111904</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">113201</td>
<td style="text-align: right;">104001</td>
<td style="text-align: right;">104001</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">101303</td>
<td style="text-align: right;">115704</td>
<td style="text-align: right;">101303</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">112901</td>
<td style="text-align: right;">113601</td>
<td style="text-align: right;">113601</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">104801</td>
<td style="text-align: right;">104901</td>
<td style="text-align: right;">104901</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">108803</td>
<td style="text-align: right;">107503</td>
<td style="text-align: right;">108803</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">102901</td>
<td style="text-align: right;">103701</td>
<td style="text-align: right;">103701</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">117202</td>
<td style="text-align: right;">115504</td>
<td style="text-align: right;">117202</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Before you start using <code>VIMuRe</code>, you need to prepare your data in a specific format. This tutorial will show you how to do that.</p>
<p>Here, we will illustrate the process of preparing data for the <code>VIMuRe</code> package using the <strong>‚ÄúData on Social Networks and Microfinance in Indian Villages‚Äù</strong> dataset <span class="citation" data-cites="banerjee_diffusion_2013">(<a href="#ref-banerjee_diffusion_2013" role="doc-biblioref">Banerjee et al. 2013b</a>)</span>. This dataset contains network data on 75 villages in the Karnataka state of India.</p>
<p><strong>‚öôÔ∏è Setup</strong></p>
<p>We will rely on the following packages in this tutorial:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="step-1-download-edgelist" class="level1">
<h1>Step 1: Download edgelist</h1>
<p>Follow the steps below to download the data.</p>
<ol type="1">
<li>Click on <a href="https://www.stanford.edu/~jacksonm/IndianVillagesDataFiles.zip">this link</a> to download the dataset from Prof.&nbsp;<a href="https://web.stanford.edu/~jacksonm/">Matthew O. Jackson‚Äôs website</a> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This will download a file called <code>IndianVillagesDataFiles.zip</code> in your working directory.</li>
<li>Unzip the file. This will create a folder called <code>2010-0760_Data</code> in your working directory. üí° Tip: you can use the <code>unzip()</code> function from within R to unzip the file.</li>
</ol>
<p>The folder structure should look like this:</p>
<p><img src="../../../figures/tutorials/jackson_download_zipfile.png" class="img-fluid" alt="Screenshot of how folder structure should look like."></p>
<p>The data we need is within that <code>Data/Raw_csv/</code> folder, and look like this:</p>
<p><img src="../../../figures/tutorials/karnataka_raw_csvs.png" class="img-fluid"></p>
</section>
<section id="step-2-collect-individual-level-metadata" class="level1">
<h1>Step 2: Collect individual-level metadata</h1>
<p>We also need individual-level information metadata. This data is available on a separate source, the Harvard Dataverse <span class="citation" data-cites="banerjee_diffusion_2013-1">(<a href="#ref-banerjee_diffusion_2013-1" role="doc-biblioref">Banerjee et al. 2013a</a>)</span>.</p>
<ol type="1">
<li>Go to <a href="https://dataverse.harvard.edu/file.xhtml?fileId=2460959&amp;version=9.4">https://dataverse.harvard.edu/file.xhtml?fileId=2460959&amp;version=9.4</a>, read and accept the ‚ÄúLicense/Data Use Agreement‚Äù to gain access to the data. We are using version 9.4 of the dataset.</li>
<li>Click on the ‚ÄúAccess File‚Äù button, then ‚ÄúDownload | ZIP Archive‚Äù to download the data.</li>
</ol>
<blockquote class="blockquote">
<p><img src="../../../figures/tutorials/dataverse_harvard_download_zipfile.png" class="img-fluid" alt="Screenshot of how to download data from Harvard Dataverse."></p>
</blockquote>
<ol start="3" type="1">
<li>Unzip the file. This will create a folder called <code>datav4.0.zip</code> in your working directory.</li>
</ol>
<p>The data we need is within that <code>datav4.0/Data/2. Demographics and Outcomes/</code> folder.</p>
<ol start="4" type="1">
<li>Read the data into Python using the <code>pd.read_stata()</code> function from pandas:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>indivinfo <span class="op">=</span> pd.read_stata(<span class="st">"datav4.0/Data/2. Demographics and Outcomes/individual_characteristics.dta"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>indivinfo.drop_duplicates(subset<span class="op">=</span>[<span class="st">"pid"</span>], inplace<span class="op">=</span><span class="va">True</span>) <span class="co">## one individual (6109803) is repeated twice.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="5" type="1">
<li>Ensure that the <code>pid</code> is a string (we will need this later):</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>indivinfo[<span class="st">"pid"</span>] <span class="op">=</span> indivinfo[<span class="st">"pid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>indivinfo[<span class="st">"hhid"</span>] <span class="op">=</span> indivinfo[<span class="st">"hhid"</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-build-an-edge-list-per-village" class="level1">
<h1>Step 3: Build an edge list per village</h1>
<p>We will now build the edge list for each village. We will illustrate the process for village 1, but if you scroll down you will find the full script for all villages.</p>
<section id="read-metadata" class="level2">
<h2 class="anchored" data-anchor-id="read-metadata">3.1. Read metadata</h2>
<p>Let‚Äôs first subset the individual-level metadata to keep only the relevant village:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep track of where the edgelist files are stored</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>RAW_CSV_FOLDER <span class="op">=</span> <span class="st">"2010-0760_Data/Data/Raw_csv"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's focus on just one village for now</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>selected_village <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the individual-level metadata to keep only the relevant village</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> indivinfo[indivinfo[<span class="st">"village"</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>resp[<span class="st">"didsurv"</span>] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>didsurv</code> column is a dummy variable that indicates whether the individual participated in the survey. We will need this information later to tell our Bayesian model who participated in the survey.</p>
</div>
</div>
</section>
<section id="read-village-data" class="level2">
<h2 class="anchored" data-anchor-id="read-village-data">3.2. Read village data</h2>
<p>Now, let‚Äôs read the <code>village_1.csv</code> file and merge it with the individual-level metadata:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>village_file <span class="op">=</span> os.path.join(RAW_CSV_FOLDER, <span class="ss">f"village</span><span class="sc">{</span>selected_village<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>indiv <span class="op">=</span> pd.read_csv(village_file, header <span class="op">=</span> <span class="va">None</span>, names<span class="op">=</span>[<span class="st">"hhid"</span>, <span class="st">"ppid"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">## gender (1-Male, 2-Female)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>indiv[<span class="st">"gender"</span>] <span class="op">=</span> indiv[<span class="st">"gender"</span>].<span class="bu">map</span>({<span class="dv">1</span>: <span class="st">"Male"</span>, <span class="dv">2</span>: <span class="st">"Female"</span>})</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">## pre-process pid to match the format in the individual-level metadata</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>indiv[<span class="st">"ppid"</span>] <span class="op">=</span> indiv[<span class="st">"ppid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>indiv[<span class="st">"hhid"</span>] <span class="op">=</span> indiv[<span class="st">"hhid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>indiv[<span class="st">"pid"</span>] <span class="op">=</span>  indiv.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x[<span class="st">"hhid"</span>]<span class="sc">}{</span><span class="dv">0</span> <span class="cf">if</span> <span class="bu">len</span>(x[<span class="st">"ppid"</span>]) <span class="op">!=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">""</span><span class="sc">}{</span>x[<span class="st">"ppid"</span>]<span class="sc">}</span><span class="ss">'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Select only the relevant columns</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>selected_cols <span class="op">=</span> [<span class="st">"pid"</span>, <span class="st">"resp_status"</span>, <span class="st">"religion"</span>, <span class="st">"caste"</span>, <span class="st">"didsurv"</span>]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>indiv <span class="op">=</span> pd.merge(indiv, resp[selected_cols], on<span class="op">=</span><span class="st">"pid"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Which produces a dataframe that looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">indiv.head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">hhid</th>
<th style="text-align: right;">ppid</th>
<th style="text-align: left;">gender</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">pid</th>
<th style="text-align: left;">resp_status</th>
<th style="text-align: left;">religion</th>
<th style="text-align: left;">caste</th>
<th style="text-align: right;">didsurv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1001</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">100101</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1001</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">100102</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1001</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">100103</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1001</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">100104</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: left;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1002</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">100201</td>
<td style="text-align: left;">Head of Household</td>
<td style="text-align: left;">HINDUISM</td>
<td style="text-align: left;">OBC</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</section>
<section id="read-reports-per-relationship-type" class="level2">
<h2 class="anchored" data-anchor-id="read-reports-per-relationship-type">3.3 Read reports per relationship type</h2>
<p>The survey that produced this data collected information on a number of different types of relationships, four of which were ‚Äúdouble sampled‚Äù (i.e., asked about in two ways, who people <strong>go</strong> to for that type of support, and who <strong>comes</strong> to them). Specifically, they asked about borrowing and receiving money, giving and receiving advice, borrowing and lending household items like kerosene and rice, and visiting and receiving guests. These distinct questions are represented in the data files with the following names:</p>
<ul>
<li>lendmoney,</li>
<li>borrowmoney,</li>
<li>giveadvice,</li>
<li>helpdecision,</li>
<li>keroricecome,</li>
<li>keroricego,</li>
<li>visitcome</li>
<li>visitgo</li>
</ul>
<p>Each of these relationships is stored in a separate file. For example, the file <code>lendmoney1.csv</code> contains information on who reported lending money to whom in village 1.</p>
<p>We can read each of these files using the <code>pd.read_csv()</code> function. For example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>filepath_lendmoney <span class="op">=</span> os.path.join(RAW_CSV_FOLDER, <span class="ss">f"lendmoney</span><span class="sc">{</span>selected_village<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lendmoney <span class="op">=</span> pd.read_csv(filepath_lendmoney, header<span class="op">=</span><span class="va">None</span>, na_values<span class="op">=</span>ALL_NA_CODES, dtype<span class="op">=</span><span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>ALL_NA_CODES</code> variable is a vector of all the codes that, after inspection, we identified were used to represent missing values in the data:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ALL_NA_CODES <span class="op">=</span> [<span class="st">"9999999"</span>, <span class="st">"5555555"</span>, <span class="st">"7777777"</span>, <span class="st">"0"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>What the data look like</strong></p>
<p>The data is stored here as a node list, but it will need to be further pre-processed as an edge list:</p>
<div style="width:60%;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;">0</th>
<th style="text-align: right;">1</th>
<th style="text-align: right;">2</th>
<th style="text-align: right;">3</th>
<th style="text-align: right;">4</th>
<th style="text-align: right;">5</th>
<th style="text-align: right;">6</th>
<th style="text-align: right;">7</th>
<th style="text-align: right;">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100201</td>
<td style="text-align: right;">107603</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="even">
<td style="text-align: right;">100202</td>
<td style="text-align: right;">102902</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100601</td>
<td style="text-align: right;">101901</td>
<td style="text-align: right;">102601</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="even">
<td style="text-align: right;">100602</td>
<td style="text-align: right;">100501</td>
<td style="text-align: right;">101902</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100701</td>
<td style="text-align: right;">100801</td>
<td style="text-align: right;">102101</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
<td style="text-align: right;">nan</td>
</tr>
</tbody>
</table>
</div>
<p>Each row represents reports made by a single individual; the first number is the <code>pid</code> (the ‚Äúperson identifier‚Äù) of the individual who reported the relationship, whereas the remaining however many numbers listed in the same row are the <code>pid</code>s of the individuals who were reported to be involved in the relationship.</p>
</section>
<section id="pre-process-the-data-to-build-the-edge-list" class="level2">
<h2 class="anchored" data-anchor-id="pre-process-the-data-to-build-the-edge-list">3.4. Pre-process the data to build the edge list</h2>
<p>We want the network data to be in the following format, plus a few additional columns:</p>
<div style="width:20%;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;">ego</th>
<th style="text-align: right;">alter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100201</td>
<td style="text-align: right;">107603</td>
</tr>
<tr class="even">
<td style="text-align: right;">100202</td>
<td style="text-align: right;">100201</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100601</td>
<td style="text-align: right;">101901</td>
</tr>
<tr class="even">
<td style="text-align: right;">100601</td>
<td style="text-align: right;">102601</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100601</td>
<td style="text-align: right;">115501</td>
</tr>
<tr class="even">
<td style="text-align: right;">100602</td>
<td style="text-align: right;">100501</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100602</td>
<td style="text-align: right;">101902</td>
</tr>
<tr class="even">
<td style="text-align: right;">100701</td>
<td style="text-align: right;">100801</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100701</td>
<td style="text-align: right;">102101</td>
</tr>
<tr class="even">
<td style="text-align: right;">100702</td>
<td style="text-align: right;">100801</td>
</tr>
</tbody>
</table>
</div>
<p>To achieve this, we will need to <a href="https://pandas.pydata.org/docs/user_guide/reshaping.html#pivot-tables">pivot</a> the data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tie_type <span class="op">=</span> <span class="st">"lendmoney"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with the lendmoney data</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>edgelist_lendmoney <span class="op">=</span> pd.melt(lendmoney, id_vars<span class="op">=</span>[<span class="dv">0</span>]).dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This produces a bogus <code>variable</code> column, which we can drop. We should also rename the columns to something more meaningful. It is <strong>important</strong> that we add a <code>reporter</code> column. This will be the <code>pid</code> of the individual who reported the relationship.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>edgelist_lendmoney <span class="op">=</span> edgelist_lendmoney.drop(columns<span class="op">=</span><span class="st">"variable"</span>)<span class="op">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>       .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"ego"</span>, <span class="st">"value"</span>: <span class="st">"alter"</span>})<span class="op">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>       .assign(reporter<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">"ego"</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's also add a column for the tie type</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>edgelist_lendmoney <span class="op">=</span> edgelist_lendmoney.assign(tie_type<span class="op">=</span>tie_type)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's add a weight column too</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>edgelist_lendmoney <span class="op">=</span> edgelist_lendmoney.assign(weight<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>producing <code>edgelist_lendmoney.head()</code>:</p>
<div style="width:50%;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;">ego</th>
<th style="text-align: right;">alter</th>
<th style="text-align: right;">reporter</th>
<th style="text-align: left;">tie_type</th>
<th style="text-align: right;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100201</td>
<td style="text-align: right;">107603</td>
<td style="text-align: right;">100201</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">100202</td>
<td style="text-align: right;">102902</td>
<td style="text-align: right;">100202</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100601</td>
<td style="text-align: right;">101901</td>
<td style="text-align: right;">100601</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">100602</td>
<td style="text-align: right;">100501</td>
<td style="text-align: right;">100602</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100701</td>
<td style="text-align: right;">100801</td>
<td style="text-align: right;">100701</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<p>So far, we only added <code>tie_type = "lendmoney"</code> to the data frame, but to make full use of VIMuRe, we also need to add the ‚Äúflipped question‚Äù to the data frame, which in this case is <code>tie_type = "borrowmoney"</code>. This is because the survey asked two different questions about borrowing and receiving money. <strong>The process is the same as before, except that we need to flip the <code>ego</code> and <code>alter</code> columns at the end.</strong></p>
<p>There are also some other data cleaning steps that we need to perform: remove self-loops, remove duplicates and keep only reports made by registered reporters. We will do all of that inside a function in the next section, to make it easier to re-use.</p>
</section>
</section>
<section id="automating-the-process" class="level1">
<h1>4. Automating the process</h1>
<section id="create-a-function-to-get-the-data-for-a-given-village-and-tie-type" class="level2">
<h2 class="anchored" data-anchor-id="create-a-function-to-get-the-data-for-a-given-village-and-tie-type">4.1. Create a function to get the data for a given village and tie type</h2>
<p>This function will also take care of the data cleaning steps that we described in the previous section. Importantly, it will also map the double-sampled tie types to the layer names we will use in VIMuRe.</p>
<details>
<summary>
Click here to expand the code for the <code>get_karnataka_survey_data()</code> function
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_karnataka_survey_data(village_id: <span class="bu">int</span>, tie_type: <span class="bu">str</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                              indivinfo: pd.DataFrame,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                              ties_layer_mapping<span class="op">=</span>{</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"borrowmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"lendmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"giveadvice"</span>: <span class="st">"advice"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"helpdecision"</span>: <span class="st">"advice"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"keroricego"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"keroricecome"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"visitgo"</span>: <span class="st">"visit"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"visitcome"</span>: <span class="st">"visit"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                              },</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                              all_na_codes<span class="op">=</span>[<span class="st">"9999999"</span>, <span class="st">"5555555"</span>, <span class="st">"7777777"</span>, <span class="st">"0"</span>],</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                              raw_csv_folder<span class="op">=</span>RAW_CSV_FOLDER):</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Read the raw data for a given tie type and village id, </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">    and return two dataframes: the edgelist and the list of respondents.</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">    village_id : int</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">        The village id, between 1 and 10.</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">    tie_type : str</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">        The tie type</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">    indivinfo : pd.DataFrame</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">        The individual-level metadata</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">    all_na_codes : list, optional</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">        The list of codes that should be interpreted as missing values, by default ["9999999", "5555555", "7777777", "0"]</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">    raw_csv_folder : str, optional</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">        The path to the folder containing the raw csv files, by default "2010-0760_Data/Data/Raw_csv"</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co">    edgelist : pd.DataFrame</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">        The edgelist</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">    respondents : list</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">        The respondent metadata</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the individual-level metadata to keep only the relevant village</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    resp <span class="op">=</span> indivinfo[indivinfo[<span class="st">"village"</span>] <span class="op">==</span> village_id].copy()</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    resp[<span class="st">"didsurv"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    village_file <span class="op">=</span> os.path.join(raw_csv_folder, <span class="ss">f"village</span><span class="sc">{</span>village_id<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> pd.read_csv(village_file, header <span class="op">=</span> <span class="va">None</span>, names<span class="op">=</span>[<span class="st">"hhid"</span>, <span class="st">"ppid"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>])</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">## gender (1-Male, 2-Female)</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"gender"</span>] <span class="op">=</span> metadata[<span class="st">"gender"</span>].<span class="bu">map</span>({<span class="dv">1</span>: <span class="st">"Male"</span>, <span class="dv">2</span>: <span class="st">"Female"</span>})</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">## pre-process pid to match the format in the individual-level metadata</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"ppid"</span>] <span class="op">=</span> metadata[<span class="st">"ppid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"hhid"</span>] <span class="op">=</span> metadata[<span class="st">"hhid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"pid"</span>] <span class="op">=</span>  metadata.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x[<span class="st">"hhid"</span>]<span class="sc">}{</span><span class="dv">0</span> <span class="cf">if</span> <span class="bu">len</span>(x[<span class="st">"ppid"</span>]) <span class="op">!=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">""</span><span class="sc">}{</span>x[<span class="st">"ppid"</span>]<span class="sc">}</span><span class="ss">'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Select only the relevant columns</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    selected_cols <span class="op">=</span> [<span class="st">"pid"</span>, <span class="st">"resp_status"</span>, <span class="st">"religion"</span>, <span class="st">"caste"</span>, <span class="st">"didsurv"</span>]</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> pd.merge(metadata, resp[selected_cols], on<span class="op">=</span><span class="st">"pid"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the raw data</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    filepath <span class="op">=</span> os.path.join(raw_csv_folder, <span class="ss">f"</span><span class="sc">{</span>tie_type<span class="sc">}{</span>village_id<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    df_raw <span class="op">=</span> pd.read_csv(filepath, header<span class="op">=</span><span class="va">None</span>, na_values<span class="op">=</span>all_na_codes, dtype<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Example with the data</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> pd.melt(df_raw, id_vars<span class="op">=</span>[<span class="dv">0</span>]).dropna()</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.drop(columns<span class="op">=</span><span class="st">"variable"</span>)<span class="op">\</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>          .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"ego"</span>, <span class="st">"value"</span>: <span class="st">"alter"</span>})<span class="op">\</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>          .assign(reporter<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">"ego"</span>])</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's also add a column for the tie type</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.assign(tie_type<span class="op">=</span>tie_type)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's add a weight column too</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.assign(weight<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the question was "Did you borrow money from anyone?", then we need to flip the ego and alter columns</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tie_type <span class="kw">in</span> [<span class="st">"borrowmoney"</span>, <span class="st">"helpdecision"</span>, <span class="st">"keroricego"</span>, <span class="st">"visitgo"</span>]:</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>        edgelist <span class="op">=</span> edgelist.rename(columns<span class="op">=</span>{<span class="st">"ego"</span>: <span class="st">"alter"</span>, <span class="st">"alter"</span>: <span class="st">"ego"</span>})</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    edgelist[<span class="st">"layer"</span>] <span class="op">=</span> edgelist[<span class="st">"tie_type"</span>].<span class="bu">map</span>(ties_layer_mapping)</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder the columns to make it easier to read</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[[<span class="st">"ego"</span>, <span class="st">"alter"</span>, <span class="st">"reporter"</span>, <span class="st">"tie_type"</span>, <span class="st">"layer"</span>, <span class="st">"weight"</span>]]</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### Further pre-processing steps ####</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Who could actually report on the ties?</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    reporters <span class="op">=</span> <span class="bu">set</span>(metadata[metadata[<span class="st">"didsurv"</span>] <span class="op">==</span> <span class="dv">1</span>][<span class="st">"pid"</span>])</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> reporters.union(<span class="bu">set</span>(edgelist[<span class="st">"ego"</span>])).union(<span class="bu">set</span>(edgelist[<span class="st">"alter"</span>]))</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only keep reports made by those who were MARKED as reporters in metadata CSV</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[edgelist[<span class="st">"reporter"</span>].isin(reporters)].copy()</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove self-loops</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[edgelist[<span class="st">"ego"</span>] <span class="op">!=</span> edgelist[<span class="st">"alter"</span>]].copy()</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove duplicates</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    edgelist.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> edgelist, reporters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="getting-an-edgelist-per-layer" class="level2">
<h2 class="anchored" data-anchor-id="getting-an-edgelist-per-layer">4.2 Getting an edgelist per layer</h2>
<p>Each double-sampled tie type is mapped to a layer in VIMuRe. The mapping can be seen in the function we created above and is also shown below.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ties_layer_mapping<span class="op">=</span>{</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"borrowmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lendmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"giveadvice"</span>: <span class="st">"advice"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"helpdecision"</span>: <span class="st">"advice"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"keroricego"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"keroricecome"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"visitgo"</span>: <span class="st">"visit"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"visitcome"</span>: <span class="st">"visit"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Therefore, to get the edgelist for, say the <code>money</code> layer, we need to combine the <code>borrowmoney</code> and <code>lendmoney</code> tie types. We can do this by using the <code>get_karnataka_survey_data</code> function we created above.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the edgelist for the money layer</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>edgelist_lendmoney, respondents <span class="op">=\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  get_karnataka_survey_data(village_id<span class="op">=</span><span class="dv">1</span>, tie_type<span class="op">=</span><span class="st">"lendmoney"</span>, indivinfo<span class="op">=</span>indivinfo)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>edgelist_borrowmoney, _ <span class="op">=</span> <span class="op">\</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  get_karnataka_survey_data(village_id<span class="op">=</span><span class="dv">1</span>, tie_type<span class="op">=</span><span class="st">"borrowmoney"</span>, indivinfo<span class="op">=</span>indivinfo)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>edgelist_money <span class="op">=</span> pd.concat([edgelist_lendmoney, edgelist_borrowmoney], axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which now gives us all the edges for the <code>money</code> layer:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>edgelist_money.sample(n<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="width:60%;">
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">ego</th>
<th style="text-align: right;">alter</th>
<th style="text-align: right;">reporter</th>
<th style="text-align: left;">tie_type</th>
<th style="text-align: left;">layer</th>
<th style="text-align: right;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">235</td>
<td style="text-align: right;">103101</td>
<td style="text-align: right;">103201</td>
<td style="text-align: right;">103201</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">229</td>
<td style="text-align: right;">101201</td>
<td style="text-align: right;">102901</td>
<td style="text-align: right;">102901</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">130</td>
<td style="text-align: right;">111904</td>
<td style="text-align: right;">112602</td>
<td style="text-align: right;">111904</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">113201</td>
<td style="text-align: right;">104001</td>
<td style="text-align: right;">104001</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">101303</td>
<td style="text-align: right;">115704</td>
<td style="text-align: right;">101303</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">345</td>
<td style="text-align: right;">112901</td>
<td style="text-align: right;">113601</td>
<td style="text-align: right;">113601</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">104801</td>
<td style="text-align: right;">104901</td>
<td style="text-align: right;">104901</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">97</td>
<td style="text-align: right;">108803</td>
<td style="text-align: right;">107503</td>
<td style="text-align: right;">108803</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">241</td>
<td style="text-align: right;">102901</td>
<td style="text-align: right;">103701</td>
<td style="text-align: right;">103701</td>
<td style="text-align: left;">borrowmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">198</td>
<td style="text-align: right;">117202</td>
<td style="text-align: right;">115504</td>
<td style="text-align: right;">117202</td>
<td style="text-align: left;">lendmoney</td>
<td style="text-align: left;">money</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<p><strong>The above is the format we want the data to be in! This format will make it easier to work with <code>VIMuRe</code>.</strong> Although, only the <code>ego</code>, <code>alter</code>, <code>reporter</code> columns are required. The <code>tie_type</code>, <code>layer</code> and <code>weight</code> columns are optional, but useful to have.</p>
<p>Use the full pre-processing script below to pre-process all the data for all tie types and save it to a single <code>vil1_money.csv</code> file. We also save the <code>reporters</code> list to, as a data frame, to a <code>vil1_money_reporters.csv</code> file.</p>
<details>
<summary>
Click to see full pre-processing script
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># village IDs 13 and 22 are missing</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>VALID_VILLAGE_IDS <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">77</span><span class="op">+</span><span class="dv">1</span>) <span class="cf">if</span> i <span class="op">!=</span> <span class="dv">13</span> <span class="kw">and</span> i <span class="op">!=</span> <span class="dv">22</span>] </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>RAW_CSV_FOLDER <span class="op">=</span> <span class="st">"2010-0760_Data/Data/Raw_csv"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>ties_layer_mapping<span class="op">=</span>{</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"borrowmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lendmoney"</span>: <span class="st">"money"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"giveadvice"</span>: <span class="st">"advice"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"helpdecision"</span>: <span class="st">"advice"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"keroricego"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"keroricecome"</span>: <span class="st">"kerorice"</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"visitgo"</span>: <span class="st">"visit"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"visitcome"</span>: <span class="st">"visit"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_karnataka_survey_data(village_id: <span class="bu">int</span>, tie_type: <span class="bu">str</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                              indivinfo: pd.DataFrame,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                              ties_layer_mapping<span class="op">=</span>ties_layer_mapping,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                              all_na_codes<span class="op">=</span>[<span class="st">"9999999"</span>, <span class="st">"5555555"</span>, <span class="st">"7777777"</span>, <span class="st">"0"</span>],</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                              raw_csv_folder<span class="op">=</span>RAW_CSV_FOLDER):</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Read the raw data for a given tie type and village id, </span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">    and return two dataframes: the edgelist and the list of respondents.</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co">    village_id : int</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co">        The village id, between 1 and 10.</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co">    tie_type : str</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co">        The tie type</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">    indivinfo : pd.DataFrame</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co">        The individual-level metadata</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co">    all_na_codes : list, optional</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">        The list of codes that should be interpreted as missing values, by default ["9999999", "5555555", "7777777", "0"]</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co">    raw_csv_folder : str, optional</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">        The path to the folder containing the raw csv files, by default "2010-0760_Data/Data/Raw_csv"</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co">    edgelist : pd.DataFrame</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co">        The edgelist</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">    respondents : list</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="co">        The respondent metadata</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the individual-level metadata to keep only the relevant village</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    resp <span class="op">=</span> indivinfo[indivinfo[<span class="st">"village"</span>] <span class="op">==</span> village_id].copy()</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    resp[<span class="st">"didsurv"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    village_file <span class="op">=</span> os.path.join(raw_csv_folder, <span class="ss">f"village</span><span class="sc">{</span>village_id<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> pd.read_csv(village_file, header <span class="op">=</span> <span class="va">None</span>, names<span class="op">=</span>[<span class="st">"hhid"</span>, <span class="st">"ppid"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>])</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">## gender (1-Male, 2-Female)</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"gender"</span>] <span class="op">=</span> metadata[<span class="st">"gender"</span>].<span class="bu">map</span>({<span class="dv">1</span>: <span class="st">"Male"</span>, <span class="dv">2</span>: <span class="st">"Female"</span>})</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">## pre-process pid to match the format in the individual-level metadata</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"ppid"</span>] <span class="op">=</span> metadata[<span class="st">"ppid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"hhid"</span>] <span class="op">=</span> metadata[<span class="st">"hhid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    metadata[<span class="st">"pid"</span>] <span class="op">=</span>  metadata.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x[<span class="st">"hhid"</span>]<span class="sc">}{</span><span class="dv">0</span> <span class="cf">if</span> <span class="bu">len</span>(x[<span class="st">"ppid"</span>]) <span class="op">!=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">""</span><span class="sc">}{</span>x[<span class="st">"ppid"</span>]<span class="sc">}</span><span class="ss">'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Select only the relevant columns</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    selected_cols <span class="op">=</span> [<span class="st">"pid"</span>, <span class="st">"resp_status"</span>, <span class="st">"religion"</span>, <span class="st">"caste"</span>, <span class="st">"didsurv"</span>]</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> pd.merge(metadata, resp[selected_cols], on<span class="op">=</span><span class="st">"pid"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the raw data</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    filepath <span class="op">=</span> os.path.join(raw_csv_folder, <span class="ss">f"</span><span class="sc">{</span>tie_type<span class="sc">}{</span>village_id<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>    df_raw <span class="op">=</span> pd.read_csv(filepath, header<span class="op">=</span><span class="va">None</span>, na_values<span class="op">=</span>all_na_codes, dtype<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Example with the data</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> pd.melt(df_raw, id_vars<span class="op">=</span>[<span class="dv">0</span>]).dropna()</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.drop(columns<span class="op">=</span><span class="st">"variable"</span>)<span class="op">\</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>          .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"ego"</span>, <span class="st">"value"</span>: <span class="st">"alter"</span>})<span class="op">\</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>          .assign(reporter<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">"ego"</span>])</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's also add a column for the tie type</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.assign(tie_type<span class="op">=</span>tie_type)</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's add a weight column too</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist.assign(weight<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the question was "Did you borrow money from anyone?", then we need to flip the ego and alter columns</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tie_type <span class="kw">in</span> [<span class="st">"borrowmoney"</span>, <span class="st">"helpdecision"</span>, <span class="st">"keroricego"</span>, <span class="st">"visitgo"</span>]:</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>        edgelist <span class="op">=</span> edgelist.rename(columns<span class="op">=</span>{<span class="st">"ego"</span>: <span class="st">"alter"</span>, <span class="st">"alter"</span>: <span class="st">"ego"</span>})</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>    edgelist[<span class="st">"layer"</span>] <span class="op">=</span> edgelist[<span class="st">"tie_type"</span>].<span class="bu">map</span>(ties_layer_mapping)</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder the columns to make it easier to read</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[[<span class="st">"ego"</span>, <span class="st">"alter"</span>, <span class="st">"reporter"</span>, <span class="st">"tie_type"</span>, <span class="st">"layer"</span>, <span class="st">"weight"</span>]]</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### Further pre-processing steps ####</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Who could actually report on the ties?</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>    reporters <span class="op">=</span> <span class="bu">set</span>(metadata[metadata[<span class="st">"didsurv"</span>] <span class="op">==</span> <span class="dv">1</span>][<span class="st">"pid"</span>])</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> reporters.union(<span class="bu">set</span>(edgelist[<span class="st">"ego"</span>])).union(<span class="bu">set</span>(edgelist[<span class="st">"alter"</span>]))</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only keep reports made by those who were MARKED as reporters in metadata CSV</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[edgelist[<span class="st">"reporter"</span>].isin(reporters)].copy()</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove self-loops</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> edgelist[edgelist[<span class="st">"ego"</span>] <span class="op">!=</span> edgelist[<span class="st">"alter"</span>]].copy()</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove duplicates</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    edgelist.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> edgelist, reporters</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_layer(village_id, layer_name, indivinfo, </span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>              raw_csv_folder<span class="op">=</span>RAW_CSV_FOLDER):</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>    tie_types <span class="op">=</span> {</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money"</span>: [<span class="st">"lendmoney"</span>, <span class="st">"borrowmoney"</span>],</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">"advice"</span>: [<span class="st">"giveadvice"</span>, <span class="st">"helpdecision"</span>],</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">"kerorice"</span>: [<span class="st">"keroricego"</span>, <span class="st">"keroricecome"</span>],</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">"visit"</span>: [<span class="st">"visitgo"</span>, <span class="st">"visitcome"</span>],</span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>    selected_tie_types <span class="op">=</span> tie_types[layer_name]</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>    edgelist <span class="op">=</span> pd.DataFrame()</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>    reporters <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tie_type <span class="kw">in</span> selected_tie_types:</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>        edgelist_, reporters_ <span class="op">=</span> get_karnataka_survey_data(village_id<span class="op">=</span>village_id, </span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>                                                            tie_type<span class="op">=</span>tie_type, </span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>                                                            indivinfo<span class="op">=</span>indivinfo,</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>                                                            raw_csv_folder<span class="op">=</span>raw_csv_folder)</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>        edgelist <span class="op">=</span> pd.concat([edgelist, edgelist_])</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>        reporters <span class="op">=</span> reporters.union(reporters_)</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> edgelist, reporters</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>indivinfo <span class="op">=</span> pd.read_stata(<span class="st">"datav4.0/Data/2. Demographics and Outcomes/individual_characteristics.dta"</span>)</span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>indivinfo.drop_duplicates(subset<span class="op">=</span>[<span class="st">"pid"</span>], inplace<span class="op">=</span><span class="va">True</span>) <span class="co">## one individual (6109803) is repeated twice.</span></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>indivinfo[<span class="st">"pid"</span>] <span class="op">=</span> indivinfo[<span class="st">"pid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>indivinfo[<span class="st">"hhid"</span>] <span class="op">=</span> indivinfo[<span class="st">"hhid"</span>].astype(<span class="bu">str</span>)</span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> VALID_VILLAGE_IDS:</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer_name <span class="kw">in</span> [<span class="st">"money"</span>, <span class="st">"advice"</span>, <span class="st">"kerorice"</span>, <span class="st">"visit"</span>]:</span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f"Processing village </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>      edgelist, reporters <span class="op">=</span> get_layer(village_id<span class="op">=</span>i, </span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>                                        layer_name<span class="op">=</span>layer_name, </span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>                                        indivinfo<span class="op">=</span>indivinfo, </span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>                                        raw_csv_folder<span class="op">=</span>RAW_CSV_FOLDER)</span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>      edgelist.to_csv(<span class="ss">f"vil</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>layer_name<span class="sc">}</span><span class="ss">.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>      <span class="co"># save reporters to a separate file</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>      pd.DataFrame({<span class="st">"reporter"</span>: <span class="bu">list</span>(reporters)}).to_csv(<span class="ss">f"vil</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>layer_name<span class="sc">}</span><span class="ss">_reporters.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Done with village </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>



</details></section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-banerjee_diffusion_2013-1" class="csl-entry" role="doc-biblioentry">
Banerjee, Abhijit, Arun G. Chandrasekhar, Esther Duflo, and Matthew O. Jackson. 2013a. <span>‚ÄúThe <span>Diffusion</span> of <span>Microfinance</span> (<span>Dataset</span>).‚Äù</span> Harvard Dataverse. <a href="https://doi.org/10.7910/DVN/U3BIHX">https://doi.org/10.7910/DVN/U3BIHX</a>.
</div>
<div id="ref-banerjee_diffusion_2013" class="csl-entry" role="doc-biblioentry">
‚Äî‚Äî‚Äî. 2013b. <span>‚ÄúThe <span>Diffusion</span> of <span>Microfinance</span>.‚Äù</span> <em>Science</em> 341 (6144): 1236498. <a href="https://doi.org/10.1126/science.1236498">https://doi.org/10.1126/science.1236498</a>.
</div>
<div id="ref-de_bacco_latent_2023" class="csl-entry" role="doc-biblioentry">
De Bacco, Caterina, Martina Contisciani, Jonathan Cardoso-Silva, Hadiseh Safdari, Gabriela Lima Borges, Diego Baptista, Tracy Sweet, et al. 2023. <span>‚ÄúLatent Network Models to Account for Noisy, Multiply Reported Social Network Data.‚Äù</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em>, February, qnac004. <a href="https://doi.org/10.1093/jrsssa/qnac004">https://doi.org/10.1093/jrsssa/qnac004</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note that the authors provide a different version of the network data on Harvard Dataverse <span class="citation" data-cites="banerjee_diffusion_2013-1">(<a href="#ref-banerjee_diffusion_2013-1" role="doc-biblioref">Banerjee et al. 2013a</a>)</span>. However, we will use the raw version provided by Prof.&nbsp;Jackson in this tutorial, as the version of the Dataverse has already had some pre-processing (importantly, they have made the adjacency matrices symmetric), while the version provided by Prof.&nbsp;Jackson gives the original node list. We will use the Harvard Dataverse files just for the metadata.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/(?:latentnetworks\.github\.io\/|localhost)/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>