---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  warning = F,
  message = F
)
```

# R Setup

The VIMuRe R package wraps the [VIMuRe](https://github.com/latentnetworks/vimure/tree/develop/src/python) Python package. We use the [`reticulate`](https://rstudio.github.io/reticulate/) package to embeds a Python session within your R session, enabling seamless, high-performance interoperability.

## Requirements

VIMuRe R package depends on R \>= 3.3.0 and it is expect to work fine in all OS.

# Installation

First, install the vimure R package from GitHub as follows:

```r
install.packages("devtools")
devtools::install_github("latentnetworks/vimure", subdir="src/R", ref="develop")
```

Then, use the `install_vimure()` function to install VIMuRe Note that on Windows you need a working installation of Anaconda.

```{r}
library(vimure)
vimure::install_vimure()
```

You can confirm that the installation succeeded with:

```{r}
library(vimure)
vimureP$utils$is_sparse(matrix(c(1:50), ncol=10))
```
This will provide you with a default installation of VIMuRe suitable for use with the vimure R package. 

## Alternate Versions

VIMuRe is distributed as a Python package and so needs to be installed within a Python environment on your system. By default, the install_vimure() function attempts to install VIMuRe within an isolated Python environment (“r-reticulate”).

Note that `install_vimure()` isn't required to use VIMuRe with the package. If you manually configure a python environment with the required dependencies, you can tell R to use it by pointing reticulate at it, commonly by setting an environment variable: 
``` R
  Sys.setenv("RETICULATE_PYTHON" = "~/path/to/python-env/bin/python")
```

By default, `install_vimure()` install the latest *develop* branch of VIMuRe You can override this behavior by specifying the version parameter. For example:

```r
install_vimure(version = "master")
```

You can also install a local version of VIMuRe by specifying a URL/Path to a VIMuRe binary. For example:
```r
install_vimure(version = "~/Git/vimure/src/python")
```


# Quick start

## Generating Ground Truth - `Y` and Observed Network - `X`

Simply create an object with the desired synthetic network class:

```{r}
random_net <- gm_Multitensor(N=100, M=100, L=1, C=2, avg_degree=10, sparsify=T, eta=0.99, seed=10)
Y <- random_net$Y$toarray()
X <- build_X(random_net, flag_self_reporter=T, cutoff_X=F, seed=10L)

paste("Reciprocity Y:", round(overall_reciprocity(Y[1,,]),3))
paste("Reciprocity X (intersection):", round(overall_reciprocity(random_net$X_intersection$toarray()[1,,]),3))
paste("Reciprocity X (union):", round(overall_reciprocity(random_net$X_union$toarray()[1,,]),3))
```
## Python interface

`vimure` is a R binding of a Python package. Many Python basic objects are quickly converted to R automatically. Custom Python objects that can not be converted automatically are stored in R as a `python.builtin.object`. As a `python.builtin.object`, you can access all object's attributes as it is in Python using the dollar sign `$`.

Use the function `class` to check if a object is stored in Python.

```{r}
class(random_net)
```

`random_net` is stored as a Python object. You can access its attributes using the dollar sign `$` or using our `extract_*` functions which always will return a R object.

## Run Model

In R we can construct and fit the vimure model by using the `vimure` function. The `vimure` function inherit all arguments from the original `VimudeModel` class and `VimureModel.fit()`. See more info about arguments in `help(vimure)`.

```{r}
model <- vimure(random_net$X, random_net$R, mutuality=T, K=2, num_realisations=1, max_iter=150)
diag <- summary(model)
```

